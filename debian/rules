#!/usr/bin/make -f
# debian/rules file, using cdbs

# cdbs support
include /usr/share/cdbs/1/rules/debhelper.mk
#include /usr/share/cdbs/1/rules/simple-patchsys.mk

MANPAGES:=$(patsubst %.sgml,%.1,$(wildcard debian/*.sgml))
DEB_INSTALL_MANPAGES_geexbox-generator:=$(MANPAGES)
DEB_INSTALL_DOCS_geexbox-generator:=$(wildcard DOCS/*.txt)

GENERATOR_NAME:=$(shell source config/path; echo $$GENERATOR_NAME;)
GENERATOR:=generator

GENERATOR_CONF:=debian/geexbox-generator.conf

build/geexbox-generator:: $(MANPAGES) $(GENERATOR_CONF) stamp-build
stamp-build:
	INSTALL=$(GENERATOR_NAME)/iso/GEEXBOX scripts/gentree generator full
	touch $@

debian/%.1:: debian/%.sgml
	/usr/bin/docbook-to-man $< > $@

clean::
	-rm stamp-build
	-rm $(MANPAGES) $(GENERATOR_CONF)
	-rm -rf $(GENERATOR_NAME)
#	-$(MAKE) clean

$(GENERATOR_CONF):: $(GENERATOR)/generator.sh
	sed -n -e"/Menu/,/RECEIVER/p" $(GENERATOR)/generator.sh | sed -e"s/LANG=.*$$/LANG=/" -e"s/SUB_FONT=.*$$/SUB_FONT=/" -e"s/REMOTE=.*$$/REMOTE=/" -e"s/RECEIVER=.*$$/RECEIVER=/" > $@

install/geexbox-generator::
	install -m 755 $(GENERATOR)/generator.sh $(CURDIR)/debian/geexbox-generator/usr/bin/geexbox-generator
	cp -r $(GENERATOR_NAME)/* $(CURDIR)/debian/geexbox-generator/usr/share/geexbox-generator/
	install -m 644 config/sort VERSION $(CURDIR)/debian/geexbox-generator/usr/share/geexbox-generator/
	install -m 644 config/lang.conf config/lang.funcs $(CURDIR)/debian/geexbox-generator/usr/share/geexbox-generator/language/
	install -m 644 $(GENERATOR_CONF) $(CURDIR)/debian/geexbox-generator/usr/share/geexbox-generator/geexbox-generator.conf.template
