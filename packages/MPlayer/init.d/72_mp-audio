#!/bin/sh
#
# configure MPlayer's audio settings

echo "### Configuring MPlayer's audio settings ###"

# include audio configuration file
. /etc/audio

# set ao to SPDIF when specified
if test "$SPDIF" = yes; then
  sed -i 's/^ao=.*/ao=alsa:device=spdif/' /etc/mplayer/mplayer.conf
fi

# set DVD default language
echo "alang=`sed 's/^\(..\).*/\1/' /etc/lang | head -1`,en" >> /etc/mplayer/mplayer.conf

# try to autodetect correct srate for AC'97 compliant chipsets
SRATE=`cat /proc/asound/card0/codec97\#0/ac97\#0-0 2>&1 | grep "PCM front DAC" | sed 's/^.*:\ \(.*\)Hz$/\1/'`

# output in 48KHz for VIA VT8233, SiS 7012, nForce (ALC650)
if test -n "`grep 'Class 0401:.*1106:3059' /proc/pci`" \
     -o -n "`grep 'Class 0401:.*10de:006a' /proc/pci`" \
     -o -n "`grep 'Class 0401:.*10de:006b' /proc/pci`" \
     -o -n "`grep 'Class 0401:.*1039:7012' /proc/pci`" \
     -o "$SRATE" = 48000; then
  echo "srate=48000" >> /etc/mplayer/mplayer.conf
fi

# force output to 44.1KHz for Ensoniq ES137{0,1,3} (SB PCI64/128)
if test -n "`grep 'Class 0401:.*1274:5000' /proc/pci`" \
     -o -n "`grep 'Class 0401:.*1274:5880' /proc/pci`" \
     -o -n "`grep 'Class 0401:.*1274:1371' /proc/pci`" \
     -o "$SRATE" = 44100; then
  echo "srate=44100" >> /etc/mplayer/mplayer.conf
fi

exit 0
