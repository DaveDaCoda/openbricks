#!/bin/sh
#
# put the right font in the right place

echo "### Setting up fonts ###"

. /etc/lang.conf
. /etc/lang.funcs

# set menu and help files according to language setting
if test -f /etc/lang; then
  LANG=`head -1 /etc/lang | sed 's/$//g'`

  cp -f /etc/mplayer/menu_$LANG.conf /etc/mplayer/menu.conf
  cp -f /usr/share/mplayer/help_$LANG.txt /usr/share/mplayer/help.txt

  MENU_CHARSET=`lang2charset $LANG`
  [ -z "$MENU_CHARSET" ] && exit 1

  MENU_FONT=`lang2font "$LANG" menu`
  MENU_FONT="/usr/share/mplayer/font/$MENU_FONT"
  [ -f "$MENU_FONT/font.desc" ] && MENU_FONT="$MENU_FONT/font.desc"
  [ ! -f "$MENU_FONT" ] && exit 1

  echo "font=$MENU_FONT" >> /etc/mplayer/mplayer.conf

  charset2mpsettings $MENU_CHARSET menu >> /etc/mplayer/mplayer.conf
fi

# set subtitles font according to subfont setting
if test -f /etc/subfont; then
  SUB_CHARSET=`head -1 /etc/subfont | sed 's/$//g'`

  SUB_CHARSET=`lang2charset "$SUB_CHARSET"`
  [ -z "$SUB_CHARSET" ] && exit 1

  SUB_FONT=`lang2font "$SUB_CHARSET" sub`
  SUB_FONT="/usr/share/mplayer/font/$SUB_FONT"
  [ -f "$SUB_FONT/font.desc" ] && SUB_FONT="$SUB_FONT/font.desc"
  [ ! -f "$SUB_FONT" ] && exit 1

  echo "subfont=$SUB_FONT" >> /etc/mplayer/mplayer.conf

  charset2mpsettings $SUB_CHARSET sub >> /etc/mplayer/mplayer.conf
fi

# set font settings according to theme
if test -f /etc/theme.conf; then
  . /etc/theme.conf

  echo "subfont-text-scale=$FONT_SIZE" >> /etc/mplayer/mplayer.conf
fi

exit 0
