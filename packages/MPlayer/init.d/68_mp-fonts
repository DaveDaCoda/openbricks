#!/bin/sh
#
# put the right font in the right place

echo "### Setting up fonts ###"

. /etc/lang.conf
. /etc/lang.funcs

# set menu and help files according to language setting
if test -f /etc/lang; then
  LANG=`head -1 /etc/lang | sed 's/$//g'`

  cp -f /etc/mplayer/menu_$LANG.conf /etc/mplayer/menu.conf
  cp -f /usr/share/mplayer/help_$LANG.txt /usr/share/mplayer/help.txt

  MENU_FONT=`lang2menufont $LANG`

  # If language doesn't require bitmap font, use ttf font
  if [ -n "$MENU_FONT" ]; then
    font2mpsettings $MENU_FONT menu- >> /etc/mplayer/mplayer.conf
    MENU_FONT="/usr/share/mplayer/font/$MENU_FONT/font.desc"
  else
    MENU_FONT="/usr/share/mplayer/font/font.ttf"
  fi

  echo "font=$MENU_FONT" >> /etc/mplayer/mplayer.conf
fi

# set subtitles font according to subfont setting
if test -f /etc/subfont; then
  SUB_CHARSET=`head -1 /etc/subfont | sed 's/$//g'`
  SUB_FONT=`subfont2font $SUB_CHARSET`

  font2mpsettings $SUB_FONT >> /etc/mplayer/mplayer.conf

  SUB_FONT="/usr/share/mplayer/font/$SUB_FONT/font.desc"
  [ ! -f "$SUB_FONT" ] && exit 1

  echo "subfont=$SUB_FONT" >> /etc/mplayer/mplayer.conf
fi

exit 0
