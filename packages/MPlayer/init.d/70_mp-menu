#!/bin/sh
#
# configure MPlayer's menu
#
# runlevels: geexbox, debug

echo "### Configuring MPlayer's menu ###"

# remove CD from menu if no cd drive is available
test -e /dev/cdrom || sed -i 's/.*play_vcd.*//' /etc/mplayer/menu.conf
test -e /dev/cdrom || sed -i 's/.*play_cdda.*//' /etc/mplayer/menu.conf

# remove DVD from the menu if no dvd drive is available
test -e /dev/dvd || sed -i -e 's/.*play_dvd.*//' -e 's/.*set_menu dvd_settings.*//' /etc/mplayer/menu.conf

# disable image file display if fbi is not present or fb not initialized
test -x /usr/bin/fbi -a -e /dev/fb0 || echo -n "" > /etc/img_ext

# build a single file extensions filter
cat /etc/file_ext > /etc/extensions
cat /etc/list_ext >> /etc/extensions
cat /etc/img_ext >> /etc/extensions

# add partitions free space in menu
for i in `mount | sed -n 's%/dev/\([sh]d[a-z][0-9]\).*%\1%p'`; do
  MENU_DF="$MENU_DF <e name=\"$i\"/>"
done
[ -n "$MENU_DF" ] && sed -i "s%name=\"ip\"/>%name=\"ip\"/> $MENU_DF%" /etc/mplayer/menu.conf

exit 0
