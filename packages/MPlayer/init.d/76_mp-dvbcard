#!/bin/sh
#
# configure MPlayer's DVB settings
#
# runlevels: geexbox, debug

echo "### Configuring MPlayer's DVB support ###"

if [ -f /var/dvbcard ]; then
  . /var/dvbcard

  # build DVB channels configuration file
  if [ ! -f /etc/mplayer/channels.conf ]; then
    if [ -f /etc/dvb.conf ]; then
      dvbscan -x 0 /etc/dvb.conf > /etc/mplayer/channels.conf
    fi
  fi
fi

# no DVB card or no configured channels
if [ ! -f /var/dvbcard \
  -o ! -f /etc/mplayer/channels.conf \
  -o ! -s /etc/mplayer/channels.conf ]; then
 # remove DVB options from menu
  sed -i 's/.*ok="set_menu dvb_sel".*//' /etc/mplayer/menu.conf
fi

exit 0
