#!/bin/sh
#
# setup MEncoder recording profiles menu
#
# runlevels: geexbox, debug

CFG=/etc/mplayer/mencoder.conf
MENU=/etc/mplayer/menu.conf
RECORD_CFG=/etc/recorder

echo "### Building MEncoder profiles selection menu ###"

# Add list of supported encoding profiles
if [ -f /usr/bin/mencoder ]; then
  echo "" >> $MENU
  echo "<cmdlist name=\"profile_sel\" title=\"Encoding Profile\" ptr=\"<>\" >" >> $MENU
  for profile in `grep "^\[" $CFG | grep -v common | grep -v dump | sed 's/\[//' | sed 's/\]//'`; do
    desc=`grep -A 1 "\[$profile\]" $CFG | grep profile-desc | sed 's/.*profile-desc=\"\(.*\)\"/\1/'` 
    echo "  <e name=\"$desc\" ok=\"run 'sed -i s/^RECORD_PROFILE.*/RECORD_PROFILE=$profile/ $RECORD_CFG'\"/>" >> $MENU
  done
  echo "</cmdlist>" >> $MENU
else
  # no encoder available
  sed -i 's/.*ok="set_menu recorder".*//' $MENU
fi

exit 0
