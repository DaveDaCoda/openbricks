#!/bin/sh
#
# setup MEncoder recording profiles menu
#
# runlevels: geexbox, debug

CFG=/etc/mplayer/mencoder.conf
MENU=/etc/mplayer/menu.conf
RECORD_PROFILE=/var/record_profile

echo "### Building MEncoder profiles selection menu ###"

# Set default profile : MPEG1 encoding
echo "mpeg1" > $RECORD_PROFILE

# Add list of supported encoding profiles
if [ -f /usr/bin/mencoder ]; then
  echo "" >> $MENU
  echo "<cmdlist name=\"profile_sel\" title=\"Encoding Profile\" ptr=\"<>\" >" >> $MENU
  for profile in `grep "^\[" $CFG | grep -v common | sed 's/\[//' | sed 's/\]//'`; do
    desc=`grep -A 1 "\[$profile\]" $CFG | grep profile-desc | sed 's/.*profile-desc=\"\(.*\)\"/\1/'` 
    echo "  <e name=\"$desc\" ok=\"run 'echo $profile > $RECORD_PROFILE'\"/>" >> $MENU
  done
  echo "</cmdlist>" >> $MENU
else
  # no encoder available
  sed -i 's/.*ok="set_menu profile_sel".*//' $MENU
fi

exit 0
