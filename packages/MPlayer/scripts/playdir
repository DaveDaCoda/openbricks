#!/bin/sh

DIR=$1
APPEND=${2:-0}
[ -d "$DIR" ] || DIR=${DIR%/[^/]*}

for i in `cat /etc/file_ext`; do
  if [ -z "$EXTS" ]; then
    EXTS="$i"
  else
    EXTS="$EXTS\|$i"
  fi
done

find "$DIR" | grep -v /GEEXBOX/ | grep -i "\.\($EXTS\)\$" | sort > /tmp/playlist.pls
find "$DIR" | grep -v /GEEXBOX/ | grep -i "\.\($EXTS\)\$" | sort > /tmp/playlist.pls
if [ -s /tmp/playlist.pls ]; then
  echo -e "menu hide\nloadlist /tmp/playlist.pls $APPEND" > /var/mp_control
else
  exit 1
fi
