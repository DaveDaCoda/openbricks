#!/bin/sh

. config/options

$SCRIPTS/install lirc $2
$SCRIPTS/install autoplay $2
$SCRIPTS/install mptvscan $2
$SCRIPTS/unpack theme-$THEME

mkdir -p $INSTALL/etc/mplayer
mkdir -p $INSTALL/usr/bin
mkdir -p $INSTALL/usr/lib/mplayer/vidix
mkdir -p $INSTALL/usr/share/mplayer

cp $BUILD/MPlayer*/mplayer $INSTALL/usr/bin
cp $BUILD/MPlayer*/libdha/*.so.1.0 $INSTALL/usr/lib
cp $BUILD/MPlayer*/vidix/drivers/*.so $INSTALL/usr/lib/mplayer/vidix
rm $INSTALL/usr/lib/mplayer/vidix/mga_crtc2_vid.so
rm $INSTALL/usr/lib/mplayer/vidix/sis_vid.so
rm $INSTALL/usr/lib/mplayer/vidix/savage_vid.so
cp $PACKAGES/MPlayer/config/mplayer.conf $INSTALL/etc/mplayer
cp $PACKAGES/MPlayer/scripts/mp_set_option $INSTALL/usr/bin
cp $PACKAGES/MPlayer/scripts/mp_wrapper $INSTALL/usr/bin
cp $PACKAGES/MPlayer/scripts/cpd $INSTALL/usr/bin
cp $PACKAGES/MPlayer/scripts/playdir $INSTALL/usr/bin

echo "You can enable nvidia vidix driver simply by removing this file." > $INSTALL/etc/mplayer/no_nvidia_vidix
echo "Vidix should give you better performance especially with low-end hardware." >> $INSTALL/etc/mplayer/no_nvidia_vidix
echo "This feature is not very well tested. That's why it is not enabled by" >> $INSTALL/etc/mplayer/no_nvidia_vidix
echo "default. And that's also why you should help us, testing this feature" >> $INSTALL/etc/mplayer/no_nvidia_vidix
echo "and reporting your results if you own nvidia hardware." >> $INSTALL/etc/mplayer/no_nvidia_vidix

mkdir -p $INSTALL/codecs

cp $BUILD/MPlayer*/etc/input.conf $INSTALL/etc/mplayer
cp $BUILD/MPlayer*/etc/codecs.conf $INSTALL/etc/mplayer

if [ "$2" != generator ]; then
  cp $BUILD/theme-$THEME/background.avi $INSTALL/usr/share/mplayer
  [ -f $BUILD/theme-$THEME/background-audio.avi ] && cp $BUILD/theme-$THEME/background-audio.avi $INSTALL/usr/share/mplayer
fi

exit 0
