#!/bin/sh

. config/options

. $CONFIG/lang.conf
. $CONFIG/lang.funcs

$SCRIPTS/install lirc $2
$SCRIPTS/install autoplay $2
$SCRIPTS/unpack theme-$THEME

mkdir -p $INSTALL/etc/mplayer
mkdir -p $INSTALL/usr/bin
mkdir -p $INSTALL/usr/lib/mplayer/vidix
mkdir -p $INSTALL/usr/share/mplayer/font

cp $BUILD/MPlayer*/mplayer $INSTALL/usr/bin
cp $BUILD/MPlayer*/libdha/*.so.1.0 $INSTALL/usr/lib
cp $BUILD/MPlayer*/vidix/drivers/*.so $INSTALL/usr/lib/mplayer/vidix
rm $INSTALL/usr/lib/mplayer/vidix/mga_crtc2_vid.so
rm $INSTALL/usr/lib/mplayer/vidix/sis_vid.so
rm $INSTALL/usr/lib/mplayer/vidix/savage_vid.so
cp $PACKAGES/MPlayer/config/mplayer.conf $INSTALL/etc/mplayer
cp $PACKAGES/MPlayer/scripts/mp_wrapper $INSTALL/usr/bin
cp $PACKAGES/MPlayer/scripts/cpd $INSTALL/usr/bin
cp $PACKAGES/MPlayer/scripts/playdir $INSTALL/usr/bin

MENU_FONT=`lang2font "$LANG" menu`
SUB_CHARSET=`lang2charset "$SUB_CHARSET"`
SUB_FONT=`lang2font "$SUB_CHARSET" sub`
[ -z "$SUB_FONT" -o -z "$MENU_FONT" ] && exit 1

echo $LANG > $INSTALL/etc/lang
echo $SUB_CHARSET > $INSTALL/etc/subfont

echo "You can enable nvidia vidix driver simply by removing this file." > $INSTALL/etc/mplayer/no_nvidia_vidix
echo "Vidix should give you better performance especially with low-end hardware." >> $INSTALL/etc/mplayer/no_nvidia_vidix
echo "This feature is not very well tested. That's why it is not enabled by" >> $INSTALL/etc/mplayer/no_nvidia_vidix
echo "default. And that's also why you should help us, testing this feature" >> $INSTALL/etc/mplayer/no_nvidia_vidix
echo "and reporting your results if you own nvidia hardware." >> $INSTALL/etc/mplayer/no_nvidia_vidix

case "$2" in
  generator)
    mkdir -p $INSTALL/codecs
    mkdir -p $GENERATOR_NAME/language
    mkdir -p $GENERATOR_NAME/font
    cp $PACKAGES/MPlayer/config/help_*.txt $GENERATOR_NAME/language
    cp $PACKAGES/MPlayer/config/menu_*.conf $GENERATOR_NAME/language
    cp -r $BUILD/MPlayer*/fonts/* $GENERATOR_NAME/font/
    for i in $FONTS; do
      mkdir -p $GENERATOR_NAME/font/$i
    done
    ;;

  installator)
    mkdir -p $INSTALL/codecs
    cp $PACKAGES/MPlayer/config/help_*.txt $INSTALL/usr/share/mplayer
    cp $PACKAGES/MPlayer/config/menu_*.conf $INSTALL/etc/mplayer
    cp -r $BUILD/MPlayer*/fonts/* $INSTALL/usr/share/mplayer/font/
    ;;

  *)
    cp $PACKAGES/MPlayer/config/help_$LANG.txt $INSTALL/usr/share/mplayer/
    cp $PACKAGES/MPlayer/config/menu_$LANG.conf $INSTALL/etc/mplayer/
    cp -r $BUILD/MPlayer*/fonts/$SUB_FONT $INSTALL/usr/share/mplayer/font/
    if [ -n "$MENU_FONT" -a "$MENU_FONT" != "$SUB_FONT" ]; then
      cp -r $BUILD/MPlayer*/fonts/$MENU_FONT $INSTALL/usr/share/mplayer/font/
    fi
    ;;
esac

cp $BUILD/MPlayer*/etc/input.conf $INSTALL/etc/mplayer
cp $BUILD/MPlayer*/etc/codecs.conf $INSTALL/etc/mplayer

cp $BUILD/theme-$THEME/*.ttf $INSTALL/usr/share/mplayer/font/font.ttf

cp $BUILD/theme-$THEME/config $INSTALL/etc/theme.conf

cp $BUILD/theme-$THEME/background.avi $INSTALL/usr/share/mplayer
[ -f $BUILD/theme-$THEME/background-audio.avi ] && cp $BUILD/theme-$THEME/background-audio.avi $INSTALL/usr/share/mplayer
