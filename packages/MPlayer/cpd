#!/bin/sh

FIFO=/var/cp_fifo
DIR=

mkfifo $FIFO 2>/dev/null

while true; do
  read CMD FILE < $FIFO

  case "$CMD" in
    cd)
      DIR=$FILE
      [ -d "$DIR" ] || DIR=${DIR%/[^/]*}
      ;;

    cp)
      [ -z "$DIR" ] && continue
      rw "$DIR"
      cp "$FILE" "$DIR"
      ro "$DIR"
      ;;

    exit)
      break;
      ;;
  esac
done

rm $FIFO
