#!/bin/sh

. config/options

INPUT_CONF="`ls -d $BUILD/MPlayer*/etc/input.conf`"

sed -i 's/.*vo_fullscreen.*//' $INPUT_CONF
echo "" >> $INPUT_CONF
echo "m menu hide" >> $INPUT_CONF
echo "; menu hide" >> $INPUT_CONF
echo "a quit" >> $INPUT_CONF
echo "s run /usr/bin/tvswitch" >> $INPUT_CONF
echo "k halt" >> $INPUT_CONF
echo "y play_dvd" >> $INPUT_CONF
echo "c mute" >> $INPUT_CONF
echo "f pt_step -1" >> $INPUT_CONF
echo "g pt_step 1" >> $INPUT_CONF

sed -i 's/.*JOY_BTN.*//' $INPUT_CONF
echo "" >> $INPUT_CONF
echo "JOY_BTN1 menu hide" >> $INPUT_CONF
echo "JOY_BTN2 pause" >> $INPUT_CONF
echo "JOY_BTN3 osd" >> $INPUT_CONF
echo "JOY_BTN4 mute" >> $INPUT_CONF
echo "JOY_BTN5 volume -1" >> $INPUT_CONF
echo "JOY_BTN6 volume 1" >> $INPUT_CONF

sed -i 's/\(cc_check -lpthread\) && $TMPO/\1/' $BUILD/MPlayer*/configure
sed -i 's/`( uname -m ) 2>&1`/'$TARGET_ARCH/ $BUILD/MPlayer*/configure

FONTS_DIR=`ls -d $BUILD/MPlayer*`/fonts
mkdir $FONTS_DIR
tar xjf $SOURCES/MPlayer/font-*-iso-8859-1.tar.bz2 -C $FONTS_DIR
tar xjf $SOURCES/MPlayer/font-*-iso-8859-2.tar.bz2 -C $FONTS_DIR
tar xjf $SOURCES/MPlayer/font-*-iso-8859-8.tar.bz2 -C $FONTS_DIR
tar xjf $SOURCES/MPlayer/windows-1251.tar.bz2 -C $FONTS_DIR
tar xjf $SOURCES/MPlayer/koi8r-font.tar.bz2 -C $FONTS_DIR
bzcat $SOURCES/MPlayer/font-*-iso-8859-2.diff.bz2 | patch -p1 -d $FONTS_DIR/font-*-iso-8859-2

mv $FONTS_DIR/font-*-iso-8859-1/font-*-24-* $FONTS_DIR/iso-8859-1
mv $FONTS_DIR/font-*-iso-8859-2/font-*-24-* $FONTS_DIR/iso-8859-2
mv $FONTS_DIR/windows-1251 $FONTS_DIR/cp1251
mv $FONTS_DIR/koi8r-font $FONTS_DIR/koi8r

rm -rf $FONTS_DIR/font-*-iso-8859-?/

exit 0
