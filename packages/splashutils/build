#!/bin/sh

. config/path

$SCRIPTS/build linux || exit 1
$SCRIPTS/build uClibc || exit 1
$SCRIPTS/build jpeg || exit 1
$SCRIPTS/build libpng || exit 1
$SCRIPTS/build zlib || exit 1

CWD=`pwd`
UCBUILD=`ls -d $ROOT/$BUILD/uClibc*/build`
export UCLIBC_GCC_DLOPT="-Wl,--dynamic-linker,/lib/ld-uClibc.so.0"
OPTIONS="CC=$UCBUILD/usr/bin/gcc LD=$UCBUILD/usr/bin/ld LIBGCC="
FLAGS="JPEGSRC=../`cd $BUILD && ls -d jpeg*` LPNGSRC=../`cd $BUILD && ls -d libpng*` ZLIBSRC=../`cd $BUILD && ls -d zlib*` UCBUILD=$UCBUILD"

cd $BUILD/splashutils* && \
make $OPTIONS splash_kern && \
make $OPTIONS $FLAGS splash_user && \
cd "$CWD" && \
exit 0

cd "$CWD"
exit 1
