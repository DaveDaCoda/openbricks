#!/bin/sh

. config/options

get_meta $1
cd $PKG_BUILD_DIR

INSTALL_PREFIX=$PWD/.install/usr

mkdir -p build
cd build
cmake -DCMAKE_FIND_ROOT_PATH=$LIB_PREFIX \
      -DCMAKE_INSTALL_PREFIX=$INSTALL_PREFIX \
      -DINCLUDE-PROJECTM-QT=0 \
      -DINCLUDE-PROJECTM-TEST=0 \
      -DINCLUDE-PROJECTM-LIBVISUAL=0 \
      -DINCLUDE-PROJECTM-PULSEAUDIO=0 \
      -DDL_LIBRARIES="" \
      ..

make
make install/strip

cd ..

sed -e "s%$INSTALL_PREFIX%$LIB_PREFIX%g" \
    -i $INSTALL_PREFIX/lib/pkgconfig/*.pc

sed -e "s%$INSTALL_PREFIX%/usr%g" \
    -i $INSTALL_PREFIX/share/projectM/config.inp

exit 0
