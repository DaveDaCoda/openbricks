#!/bin/sh

. config/options

get_meta $1
cd $PKG_BUILD_DIR

INSTALL_PREFIX=$PWD/.install/usr

mkdir -p build
cd build

sed -i ../plugins/src/render.text/CMakeLists.txt \
    -e "s%/usr/include/freetype2%$LIB_PREFIX/include/freetype2%"

sed -i ../plugins/src/texture/CMakeLists.txt \
    -e "s%/usr/include/OpenEXR%$LIB_PREFIX/include/OpenEXR%"

cmake -DCMAKE_FIND_ROOT_PATH=$LIB_PREFIX \
      -DCMAKE_INSTALL_PREFIX=$INSTALL_PREFIX \
      ..
make
make install/strip

cd ..

sed -i .install/usr/lib/pkgconfig/*.pc \
    -e "s%^prefix=.*%prefix=$LIB_PREFIX%"

sed -i .install/usr/share/applications/*.desktop \
    -e "s%$INSTALL_PREFIX%/usr%g"
