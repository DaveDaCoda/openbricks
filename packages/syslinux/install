#!/bin/sh

. config/path

case "$2" in
  binary)
    mkdir -p $INSTALL/usr/bin
    mkdir -p $INSTALL/boot
    mkdir -p $INSTALL/usr/share/syslinux
    cp $BUILD/syslinux-*/syslinux $INSTALL/usr/bin
    cp $BUILD/syslinux-*/ldlinux.sys $INSTALL/boot
    cp $BUILD/syslinux-*/mbr.bin $INSTALL/usr/share/syslinux
    ;;

  installator)
    cp $BUILD/syslinux-*/mbr.bin $INSTALLATOR_NAME
    cp $PACKAGES/syslinux/isolinux.cfg $INSTALL
    ;;

  *)
    mkdir -p $INSTALL/boot/pxelinux.cfg
    cp $BUILD/syslinux-*/isolinux.bin $INSTALL/boot
    cp $PACKAGES/syslinux/isolinux.cfg $INSTALL/boot
    cp $BUILD/syslinux-*/pxelinux.0 $INSTALL/boot
    sed "s/boot=[^ ]*/boot=nfs/" $PACKAGES/syslinux/isolinux.cfg > $INSTALL/boot/pxelinux.cfg/default
    sed -i "s%\(.*APPEND.*\)%\1 nfsroot=$DEFAULT_NFS_SERVER:/tftpboot/GEEXBOX%" $INSTALL/boot/pxelinux.cfg/default
    ;;
esac
