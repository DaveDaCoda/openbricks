#!/bin/sh

. config/options

$SCRIPTS/build toolchain || exit 1
$SCRIPTS/build libirman || exit 1

CWD=`pwd`
export CROSS_COMPILE=$TARGET_PREFIX
export ARCH=$TARGET_ARCH
export ac_cv_path_LIBUSB_CONFIG=

CFLAGS="$CFLAGS -I`ls -d $ROOT/$BUILD/libirman*`"
LDFLAGS="$LDFLAGS -L`ls -d $ROOT/$BUILD/libirman*`"

cd $BUILD/lirc* && \
./configure --host=$TARGET_NAME \
            --build=$HOST_NAME \
            --disable-shared \
            --without-x \
            --with-driver=any \
            --with-port=0x3f8 \
            --with-irq=4 \
            --with-kerneldir=$KERNEL && \
make && \
$STRIP daemons/lircd tools/irpty && \
ln -sf tools lirc && \
cd "$CWD" && \
exit 0

cd "$CWD"
exit 1
