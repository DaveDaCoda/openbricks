#!/bin/sh

. config/options

$SCRIPTS/build toolchain || exit 1
$SCRIPTS/build linux || exit 1

unset INSTALL
CWD=`pwd`
export CROSS_COMPILE=$TARGET_PREFIX
export ARCH=$TARGET_ARCH

cd $BUILD/em8300* && \
make -C modules PWD="`ls -d $ROOT/$BUILD/em8300-*/modules`" KERNEL_LOCATION=$KERNEL && \
CFLAGS="$CFLAGS -isystem=$KERNEL/include" && \
./configure --host=$TARGET_NAME \
            --build=$HOST_NAME \
            --prefix=$LIB_PREFIX \
            --enable-static \
            --disable-shared \
            --disable-gtktest && \
make -C libdxr3 && \
make -C em8300setup && \
make -C include install em8300incdir="$LIB_PREFIX/include/linux" && \
make -C libdxr3 install && \
$STRIP em8300setup/em8300setup && \
cd "$CWD" && \
exit 0

cd "$CWD"
exit 1
