#!/bin/sh

. config/options toolchain

$SCRIPTS/build toolchain || exit 1
$SCRIPTS/build linux || exit 1

CWD=`pwd`
export CROSS_COMPILE=$TARGET_PREFIX
export ARCH=$TARGET_ARCH

cd $BUILD/em8300* && \
make -C modules PWD="`ls -d $ROOT/$BUILD/em8300-*/modules`" KERNEL_LOCATION=$KERNEL && \
CFLAGS="$CFLAGS -isystem=$KERNEL/include" && \
./configure --host=$TARGET_NAME \
            --build=$HOST_NAME \
            --prefix=/usr \
            --enable-static \
            --disable-shared \
            --disable-gtktest && \
make -C libdxr3 && \
make -C em8300setup && \
$STRIP em8300setup/em8300setup && \
cd "$CWD" && \
exit 0

cd "$CWD"
exit 1
