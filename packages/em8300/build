#!/bin/sh

. config/path

$SCRIPTS/build uClibc || exit 1
$SCRIPTS/build linux || exit 1

CWD=`pwd`
UCBIN=`ls -d $ROOT/$BUILD/uClibc*/build/usr/bin`
export UCLIBC_GCC_DLOPT="-Wl,--dynamic-linker,/lib/ld-uClibc.so.0" && \

cd $BUILD/em8300* && \
make -C modules PWD="`ls -d $ROOT/$BUILD/em8300-*/modules`" KERNEL_LOCATION="`ls -d $ROOT/$BUILD/linux-*`" && \
CC=$UCBIN/gcc CFLAGS="-Os -isystem=`ls -d $ROOT/$BUILD/linux*/include`" ./configure --prefix=/usr --enable-static --disable-shared --disable-gtktest --host=i386-linux-gnu && \
make -C libdxr3 && \
make -C em8300setup && \
strip em8300setup/em8300setup && \
cd "$CWD" && \
exit 0

cd "$CWD"
exit 1
