#!/bin/sh

. config/options

$SCRIPTS/build toolchain || exit 1

CWD=`pwd`
SMB=`ls -d $BUILD/samba*/source`
export CC=$TARGET_CC
export CFLAGS="-Os"
export LDFLAGS="-s"
export samba_cv_HAVE_GETTIMEOFDAY_TZ=yes
export samba_cv_USE_SETEUID=yes
export samba_cv_HAVE_IFACE_IFCONF=yes

cd $SMB && \
./configure --host=$TARGET_NAME \
            --with-smbmount \
            --without-ldap \
            --without-winbind \
            --with-included-popt \
            --with-libsmbclient \
            --without-ads && \
make include/proto.h \
     bin/smbmount \
     bin/smbmnt \
     bin/smbtree \
     bin/libsmbclient.a && \
cd "$CWD" && \
$SCRIPTS/libstrip $SMB/bin/libsmbclient.so.0 $SMB/bin/libsmbclient.a "$SMB/bin/smbmount $SMB/bin/smbmnt $SMB/bin/smbtree" && \
exit 0

cd "$CWD"
exit 1
