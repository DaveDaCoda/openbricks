#!/bin/sh

. config/path

$SCRIPTS/build uClibc || exit 1

export CC="`ls $ROOT/$BUILD/uClibc-*/build/usr/bin/gcc`"
CWD=`pwd`

cd `ls -d $BUILD/samba-*/source` && \
./configure --with-smbmount --without-ldap --without-winbind --with-included-popt --with-libsmbclient --without-ads && \
export UCLIBC_GCC_DLOPT="-Wl,--dynamic-linker,/lib/ld-uClibc.so.0" && \
make include/proto.h bin/smbmount bin/smbmnt bin/smbtree bin/libsmbclient.a CFLAGS="-Os" && \
$ROOT/$SCRIPTS/libstrip bin/libsmbclient.so.0 bin/libsmbclient.a "bin/smbmount bin/smbmnt bin/smbtree" && \
strip bin/smbmount bin/smbmnt bin/smbtree && \
cd "$CWD" && \
exit 0

cd "$CWD"
exit 1
