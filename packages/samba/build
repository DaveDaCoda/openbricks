#!/bin/sh

. config/path

$SCRIPTS/build uClibc || exit 1

export CC="`ls $ROOT/$BUILD/uClibc*/build/usr/bin/gcc`"
SMB=`ls -d $BUILD/samba*/source`
CWD=`pwd`

cd $SMB && \
./configure --with-smbmount --without-ldap --without-winbind --with-included-popt --with-libsmbclient --without-ads && \
export UCLIBC_GCC_DLOPT="-Wl,--dynamic-linker,/lib/ld-uClibc.so.0" && \
make include/proto.h bin/smbmount bin/smbmnt bin/smbtree bin/libsmbclient.a CFLAGS="-Os" && \
strip bin/smbmount bin/smbmnt bin/smbtree && \
cd "$CWD" && \
$SCRIPTS/libstrip $SMB/bin/libsmbclient.so.0 $SMB/bin/libsmbclient.a "$SMB/bin/smbmount $SMB/bin/smbmnt $SMB/bin/smbtree" && \
exit 0

cd "$CWD"
exit 1
