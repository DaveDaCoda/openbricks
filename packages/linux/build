#!/bin/sh

. config/options

$SCRIPTS/install gcc toolchain || exit 1
$SCRIPTS/build module-init-tools || exit 1

DEPMOD="`ls -d $ROOT/$BUILD/module-init-tool*/depmod`"
LINUX="`ls -d $ROOT/$BUILD/linux*`"
export CROSS_COMPILE=$TARGET_PREFIX
export ARCH=$TARGET_ARCH

make clean -C "$LINUX" && \
make bzImage -C "$LINUX" && \
make modules -C "$LINUX" && \
make INSTALL_MOD_PATH="$LINUX/modules" DEPMOD=$DEPMOD modules_install -C "$LINUX" && \
rm -f $LINUX/modules/lib/modules/*/build && \
rm -f $LINUX/modules/lib/modules/*/source && \
exit 0

exit 1
