#!/bin/sh

. config/path

LINUX="`ls -d $ROOT/$BUILD/linux-*`"
export CFLAGS="-D__KERNEL__ -I$LINUX/include -Os -fno-strict-aliasing -fomit-frame-pointer"

make CFLAGS="$CFLAGS" dep -C "$LINUX" && \
make CFLAGS="$CFLAGS" clean -C "$LINUX" && \
make CFLAGS="$CFLAGS" bzImage -C "$LINUX" && \
make CFLAGS="$CFLAGS" modules -C "$LINUX" && \
make INSTALL_MOD_PATH="$LINUX/modules" modules_install -C "$LINUX" && \
rm -f $LINUX/modules/lib/modules/*/build && \
rmdir $LINUX/modules/lib/modules/*/pcmcia && \
exit 0

exit 1
