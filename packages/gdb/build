#!/bin/sh

. config/options

$SCRIPTS/build toolchain || exit 1
$SCRIPTS/build ncurses || exit 1

CWD=`pwd`
NCURSES="`ls -d $ROOT/$BUILD/ncurses*`"
export CC=$TARGET_CC
export CFLAGS="-I$NCURSES/include -L$NCURSES/lib"
export bash_cv_have_mbstate_t=set

PARTS="libiberty bfd readline opcodes gdb"

cd $BUILD/gdb*
for i in $PARTS; do
  cd $i && \
  ./configure --host=$TARGET_NAME \
              --build=$HOST_NAME \
              --disable-nls && \
  sed -i 's/.*HAVE_CURSES_H.*/#define HAVE_CURSES_H 1/' config.h && \
  make && \
  cd .. && \
  continue
  cd "$CWD"
  exit 1
done
cd "$CWD"
exit 0
