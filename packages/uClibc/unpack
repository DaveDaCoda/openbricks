#!/bin/sh

. config/options

$SCRIPTS/unpack linux

UCLIBC=`ls -d $BUILD/uClibc*`

sed -i -e "s|^HOSTCC[[:space:]]*=.*$|HOSTCC = $HOST_CC|" \
       -e "s|^CROSS[[:space:]]*=.*$|CROSS = $TARGET_PREFIX|" \
       $UCLIBC/Rules.mak

sed -e "s%^KERNEL_SOURCE=.*%KERNEL_SOURCE=\"$(kernel_path)\"%" \
    $PACKAGES/uClibc/config/uClibc.$TARGET_ARCH.conf > $UCLIBC/.config

make -C $UCLIBC oldconfig
make -C $UCLIBC pregen
make -C $UCLIBC PREFIX="$SYSROOT_PREFIX" install_dev
