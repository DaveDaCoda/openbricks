#!/bin/sh

. config/options

. $CONFIG_MACHINE/meta

get_meta $1
cd $PKG_BUILD_DIR

[ -d .install ] && rm -rf .install
mkdir -p .install/boot
installdir=".install/boot"

if [ -n "$MACHINE_UBOOT_BINARY" ]; then
  cp $MACHINE_UBOOT_BINARY $installdir
else
  cp u-boot.bin $installdir
fi

if [ -n "$MACHINE_UBOOT_CONFIG_EXTRA" ]; then
  mkdir -p $installdir/extra-uboot
  cp extra-uboot/* $installdir/extra-uboot
fi

if [ -n "$MACHINE_UBOOT_LOADER" ]; then
  cp $MACHINE_UBOOT_LOADER $installdir
fi

[ -r boot.cfg ] && \
  cp boot.cfg $installdir

if [ -r boot.ini ]; then
  if [ -n "$MACHINE_UBOOT_SCRIPT" ]; then
    cp boot.ini $installdir/$MACHINE_UBOOT_SCRIPT
  else
    cp boot.ini $installdir
    # some boards read boot.scr by default
    cp $installdir/boot.ini $installdir/boot.scr
  fi  
fi

if [ -r uEnv.txt ] ; then
  cp uEnv.txt $installdir
fi

do_install boot