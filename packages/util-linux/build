#!/bin/sh

. config/path

$SCRIPTS/build uClibc || exit 1
$SCRIPTS/build ncurses || exit 1

export CC="`ls $ROOT/$BUILD/uClibc-*/build/usr/bin/gcc`"
export UCLIBC_GCC_DLOPT="-Wl,--dynamic-linker,/lib/ld-uClibc.so.0"
CWD=`pwd`

cd `ls -d $BUILD/util-linux*` && \
export CFLAGS="-Os -I`ls -d ../ncurses*/include`" && \
./configure && \
make -C fdisk sfdisk CFLAGS="-Os" && \
make -C fdisk cfdisk CFLAGS="-Os -include ../defines.h -I../lib -I../`ls -d ../ncurses*/include`" LDFLAGS="-s -L../`ls -d ../ncurses*/lib`" && \
cd "$CWD" && \
exit 0

cd "$CWD"
exit 1
