#!/bin/sh

. config/options

mkdir -p $INSTALL/etc

case "$2" in
  generator)
    $SCRIPTS/build bootsplash

    mkdir -p $GENERATOR_NAME/themes
    for i in $PACKAGES/$1-*; do
      b=`basename $i`
      $SCRIPTS/unpack $b
      cp -r $BUILD/$b $GENERATOR_NAME/themes/

      cd $GENERATOR_NAME/themes/$b

      . ./config
      [ -z "$RESOLUTIONS" ] && RESOLUTIONS=800x600

      for r in $RESOLUTIONS; do
        $ROOT/$BUILD/bootsplash*/Utilities/splash -s -f bootsplash-$r.cfg > bootsplash-$r.dat
      done
      rm -f bootsplash-*.cfg bootsplash-*.jpg bootsplash-*.jpeg
      cd $ROOT
    done
    echo "theme-$THEME" > $GENERATOR_NAME/themes/default
    ;;

  *)
    $SCRIPTS/unpack theme-$THEME

    cp $BUILD/theme-$THEME/config $INSTALL/etc/theme.conf
    ;;
esac
