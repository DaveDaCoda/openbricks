#!/bin/sh

. config/options

get_meta $1
BUILD_DIR=$ROOT/$PKG_BUILD_DIR

get_meta $PKG_PARENT
PARENT_BUILD_DIR=$ROOT/$PKG_BUILD_DIR

cd $BUILD_DIR
for f in c_rehash make-ca.sh make-cert.pl remove-expired-certs.sh; do
  cp $PARENT_BUILD_DIR/.install/usr/bin/$f .
done

sed -e "s%^#!/usr/bin/perl%#!$ROOT/$TOOLCHAIN/bin/perl%" -i c_rehash *.pl
sed -e "s%^CONVERTSCRIPT=.*%CONVERTSCRIPT=$BUILD_DIR/make-cert.pl%" -i make-ca.sh

./make-ca.sh
./remove-expired-certs.sh certs
./c_rehash certs
mv -f BLFS-ca-bundle-*.crt ca-bundle.crt

rm -rf .install
mkdir -p .install/etc/ssl
mv -t .install/etc/ssl ca-bundle.crt certs 
