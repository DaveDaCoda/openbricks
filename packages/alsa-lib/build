#!/bin/sh

. config/path

$SCRIPTS/build uClibc || exit 1
$SCRIPTS/build alsa-driver || exit 1

CWD=`pwd`
UCBIN=`ls -d $ROOT/$BUILD/uClibc-*/build/usr/bin`

cd "`ls -d $BUILD/alsa-lib-*`" && \
CC=$UCBIN/gcc ./configure --disable-static --enable-shared --with-debug=no --with-versioned=no --disable-dependency-tracking --host=i386-linux-gnu && \
export UCLIBC_GCC_DLOPT="-Wl,--dynamic-linker,/lib/ld-uClibc.so.0" && \
make -C src CFLAGS="-Os" && \
ar cru src/.libs/libasound.a `find src -name '*.lo'` && \
cd "$CWD" && \
exit 0

cd "$CWD"
exit 1
