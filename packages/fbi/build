#!/bin/sh

. config/options

$SCRIPTS/build toolchain || exit 1
$SCRIPTS/build libpcd || exit 1
$SCRIPTS/build jpeg || exit 1
$SCRIPTS/build libpng || exit 1
$SCRIPTS/build zlib || exit 1
$SCRIPTS/build libungif || exit 1
$SCRIPTS/build libexif || exit 1
$SCRIPTS/build lirc || exit 1


EXTRA_HEADERS="-I`ls -d $ROOT/$BUILD/libpcd*/` -I`ls -d $ROOT/$BUILD/jpeg*/` -I`ls -d $ROOT/$BUILD/libpng*/` -I`ls -d $ROOT/$BUILD/libungif*/lib/` -I`ls -d $ROOT/$BUILD/libexif*/` -I`ls -d $ROOT/$BUILD/lirc*/` -I`ls -d $ROOT/$BUILD/zlib*/`"

CWD=`pwd`
export CFLAGS="-Os -ffast-math $EXTRA_HEADERS"

cd `ls -d $BUILD/fbi*` && \
make prefix="/usr/bin" \
     CC=$TARGET_CC \
     PCD_LDLIBS="`ls $ROOT/$BUILD/libpcd*/libpcd.a`" \
     JPEG_LDLIBS="`ls $ROOT/$BUILD/jpeg*/libjpeg.a`" \
     PNG_LDLIBS="`ls $ROOT/$BUILD/libpng*/libpng.a` -L`ls -d $ROOT/$BUILD/zlib*/` -lz" \
     UNGIF_LDLIBS="`ls $ROOT/$BUILD/libungif*/lib/.libs/libungif.a`" \
     EXIF_LDLIBS="`ls $ROOT/$BUILD/libexif*/libexif/.libs/libexif.a`" \
     LIRC_LDLIBS="`ls $ROOT/$BUILD/lirc*/lirc/.libs/liblirc_client.a`" \
     fbi && \
$TARGET_STRIP fbi && \
cd "$CWD" && \
exit 0

cd "$CWD"
exit 1
