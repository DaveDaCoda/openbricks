#!/bin/sh

. config/path
. $CONFIG/options

$SCRIPTS/build libpcd || exit 1
$SCRIPTS/build jpeg || exit 1
$SCRIPTS/build libpng || exit 1
$SCRIPTS/build zlib || exit 1
$SCRIPTS/build libungif || exit 1
$SCRIPTS/build libexif || exit 1
$SCRIPTS/build lirc || exit 1


EXTRA_HEADERS="-I`ls -d $ROOT/$BUILD/libpcd*/` -I`ls -d $ROOT/$BUILD/jpeg*/` -I`ls -d $ROOT/$BUILD/libpng*/` -I`ls -d $ROOT/$BUILD/libungif*/lib/` -I`ls -d $ROOT/$BUILD/libexif*/` -I`ls -d $ROOT/$BUILD/lirc*/` -I`ls -d $ROOT/$BUILD/zlib*/`"

export UCLIBC_GCC_DLOPT="-Wl,--dynamic-linker,/lib/ld-uClibc.so.0"
CWD=`pwd`

cd `ls -d $BUILD/fbi*` && \
CFLAGS="-Os -ffast-math $EXTRA_HEADERS" make prefix="/usr/bin" CC="$ROOT/$BUILD/uClibc*/build/usr/bin/gcc" PCD_LDLIBS="`ls $ROOT/$BUILD/libpcd*/libpcd.a`" JPEG_LDLIBS="`ls $ROOT/$BUILD/jpeg*/libjpeg.a`" PNG_LDLIBS="`ls $ROOT/$BUILD/libpng*/libpng.a` `ls $ROOT/$BUILD/zlib*/libz.a`" UNGIF_LDLIBS="`ls $ROOT/$BUILD/libungif*/lib/.libs/libungif.a`" EXIF_LDLIBS="`ls $ROOT/$BUILD/libexif*/libexif/.libs/libexif.a`" LIRC_LDLIBS="`ls $ROOT/$BUILD/lirc*/lirc/.libs/liblirc_client.a`" fbi && \
strip fbi && \
cd "$CWD" && \
exit 0

cd "$CWD"
exit 1
